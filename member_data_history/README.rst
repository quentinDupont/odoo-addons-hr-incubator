===================
Member Data History
===================

.. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

.. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
    :target: https://odoo-community.org/page/development-status
    :alt: Beta
.. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
    :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
    :alt: License: AGPL-3
.. |badge3| image:: https://img.shields.io/badge/github-odoo-cae%2Fodoo--addons--hr--incubator-lightgray.png?logo=github
    :target: https://github.com/odoo-cae/odoo-addons-hr-incubator/tree/12.0/member_data_history
    :alt: odoo-cae/odoo-addons-hr-incubator

|badge1| |badge2| |badge3| 

Logs value changes for selected fields.
Logged values are accessible under the configuration tab of the human resources app.

**Table of contents**

.. contents::
   :local:

Usage
=====

Data is stored in the model `value.log` and its matching table:

.. code-block:: console

    coopaname-test> \d value_log
    +----------------+-----------------------------+---------------------------------------------------------+
    | Column         | Type                        | Modifiers                                               |
    |----------------+-----------------------------+---------------------------------------------------------|
    | id             | integer                     |  not null default nextval('value_log_id_seq'::regclass) |
    | model          | character varying           |  not null                                               |
    | field          | character varying           |  not null                                               |
    | user_id        | integer                     |  not null                                               |
    | date           | date                        |  not null                                               |
    | previous_value | character varying           |                                                         |
    | new_value      | character varying           |                                                         |
    | create_uid     | integer                     |                                                         |
    | create_date    | timestamp without time zone |                                                         |
    | write_uid      | integer                     |                                                         |
    | record_id      | integer                     |                                                         |
    | write_date     | timestamp without time zone |                                                         |
    +----------------+-----------------------------+---------------------------------------------------------+g


To log a value change, overload `write` like this
(for zip field on res.partner model):

.. code-block:: python

    class ResPartner(models.Model):
        _inherit = "res.partner"

        @api.multi
        def write(self, vals):
            if "zip" in vals:
                self.env["value.log"].create(
                    {
                        "model": "res.partner",
                        "field": "zip",
                        "record_id", self.id,
                        "previous_value": str(self.zip),
                        "new_value": str(vals.get("zip")),
                    }
                )
            return super(ResPartner, self).write(vals)

If you need to log a value on creation, overwrite `create(vals)`.

Bug Tracker
===========

Bugs are tracked on `GitHub Issues <https://github.com/odoo-cae/odoo-addons-hr-incubator/issues>`_.
In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us smashing it by providing a detailed and welcomed
`feedback <https://github.com/odoo-cae/odoo-addons-hr-incubator/issues/new?body=module:%20member_data_history%0Aversion:%2012.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.

Do not contact contributors directly about support or help with technical issues.

Credits
=======

Authors
~~~~~~~

* Coop IT Easy SCRLfs

Contributors
~~~~~~~~~~~~

* Robin Keunen <robin@coopiteasy.be>

Maintainers
~~~~~~~~~~~

This module is part of the `odoo-cae/odoo-addons-hr-incubator <https://github.com/odoo-cae/odoo-addons-hr-incubator/tree/12.0/member_data_history>`_ project on GitHub.

You are welcome to contribute.
